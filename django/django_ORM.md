# Django ORM

* mainapp/models.py
```python
from django.db import models

class Book(models.Model):
    book_name = models.CharField(max_length=100)


class Author(models.Model):
    name = models.CharField(max_length=100)
    book = models.ForeignKey(Book, on_delete=models.CASCADE)
```
* создаем файл мигации т.е. создается файл mainapp/migrations/0001_initial.py в котором написана инструкция, какие изменения внести в базу данных чтобы сформировалась нужна структура
```
python manage.py makemigrations
```
* содержимое файла сгенерировалось автоматически, изменять его не нужно
```python
# Generated by Django 4.2.4 on 2023-09-10 16:48

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='Book',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('book_name', models.CharField(max_length=100)),
            ],
        ),
        migrations.CreateModel(
            name='Author',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('book', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='mainapp.book')),
            ],
        ),
    ]

```
* применяем миграции т.е. создаем структуру в самой БД, в коробке идет БД sqlite3
```
python manage.py migrate
```
* натройки базы данных есть в файле config/settings.py
```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}
```
* чтобы подключить postgres
```
sudo apt update && sudo apt install postgresql
```
* драйвер для подключения postgres
```
pip install psycopg2-binary
```
```
createdb -U postgres library
```
* изменяем настройки в config/settings.py
```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'library',
        'USER': 'postgres',
        'PASSWORD': 'postgres',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}
```
```
python manage.py migrate
```
* открыть консоль postgres
```
sudo -u postgres psql
```
* список БД
```
\l
```
* создать БД
```
CREATE DATABASE db_name;
```
* переход на нужную БД
```
\c db_name
```
* показать все таблицы БД
```
\d
```
* открыть свойства таблицы БД
```
\d table_name
```
* открыть таблицу
```
SELECT * FROM table_name;
```
* удалить БД
```
DROP DATABASE db_name;
```
* если появляется ошибка ERROR:  database "library" is being accessed by other users
```sql
SELECT pg_terminate_backend (pg_stat_activity.pid)
FROM pg_stat_activity
WHERE pg_stat_activity.datname = 'db_name' AND pid <> pg_backend_pid();

```
* передать данные из view в БД
```python
from mainapp.models import Book

def orm(request):
    data = Book(name='some_data')
    data.save()

    return render(request, 'mainapp/orm.html')
```
* получение данных из БД
```python
from mainapp.models import Book

def get_data_orm(request):
    data = Book.objects.all()
    #действие с данными
    context = {
            data: 'data',
        }

    return render(request, 'mainapp/orm.html', context)
```
### Админка Djnago
* в mainapp/admin.py
```python
from django.contrib import admin
from .models import Book


@admin.register(Book)
class BookAdmin(admin.ModelAdmin):
    list_display = 'id', 'book_name'
```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
* 
```

```
